<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ㄏㄜˋ的沖繩五天四夜行程</title>
    <!-- 引入 React 與 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 自定義捲軸樣式 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        body {
            font-family: "Noto Sans TC", sans-serif;
            background-color: #f8fafc;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 隱藏橫向捲軸但保留功能 (for Tabs) */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 圖標組件封裝
        const Icons = {
            Plane: () => <i data-lucide="plane" className="w-5 h-5"></i>,
            Hotel: () => <i data-lucide="bed-double" className="w-5 h-5"></i>,
            Car: () => <i data-lucide="car" className="w-5 h-5"></i>,
            MapPin: () => <i data-lucide="map-pin" className="w-5 h-5"></i>,
            Clock: () => <i data-lucide="clock" className="w-5 h-5"></i>,
            Wallet: () => <i data-lucide="wallet" className="w-5 h-5"></i>,
            Calendar: () => <i data-lucide="calendar" className="w-5 h-5"></i>,
            Utensils: () => <i data-lucide="utensils" className="w-5 h-5"></i>,
            Info: () => <i data-lucide="info" className="w-4 h-4"></i>,
            ArrowRight: () => <i data-lucide="arrow-right" className="w-4 h-4"></i>,
            X: () => <i data-lucide="x" className="w-5 h-5"></i>,
            MessageSquare: () => <i data-lucide="message-square" className="w-5 h-5"></i>,
            Map: () => <i data-lucide="map" className="w-4 h-4"></i>,
            ExternalLink: () => <i data-lucide="external-link" className="w-3 h-3"></i>,
            FileText: () => <i data-lucide="file-text" className="w-5 h-5"></i>,
            Printer: () => <i data-lucide="printer" className="w-4 h-4"></i>,
            Timer: () => <i data-lucide="timer" className="w-4 h-4"></i>,
        };

        // 模擬數據
        const TRIP_DATA = {
            meta: {
                title: "沖繩五天四夜跨年之旅",
                dates: "2025/12/30 (二) - 2026/01/03 (六)",
                travelers: 2,
                rate: 0.21 // 匯率
            },
            flights: [
                { type: "去程", code: "IT230", date: "12/30", time: "06:35 - 08:55", seat: "5AB", from: "TPE", to: "OKA" },
                { type: "回程", code: "IT233", date: "01/03", time: "21:30 - 22:05", seat: "28AB", from: "OKA", to: "TPE" }
            ],
            hotels: [
                { date: "12/30 (二)", name: "HOTEL NAHA CITY", area: "那霸", price: 6881, currency: "JPY", note: "停車 ¥1000/日" },
                { date: "12/31 (三)", name: "HOTEL YUQUESTA AGARIMACHI", area: "那霸", price: 8100, currency: "JPY", note: "含早餐" },
                { date: "01/01 (四)", name: "超級飯店 (Super Hotel)", area: "名護", price: 5440, currency: "JPY", note: "提早到選枕頭 (預估價格)" },
                { date: "01/02 (五)", name: "那霸倫勃朗風格飯店", area: "那霸", price: 4710, currency: "JPY", note: "Rembrandt Style Naha" }
            ],
            itinerary: [
                {
                    day: 1,
                    date: "12/30 (二)",
                    dateStr: "2025-12-30", // 用於倒數計時比對
                    events: [
                        { time: "06:35", endTime: "08:55", title: "抵達那霸機場", type: "transport", location: "那霸機場", cost: 0, note: "航班 IT230" },
                        {
                            time: "09:30",
                            endTime: "10:00",
                            title: "租車取車",
                            type: "transport",
                            location: "Brother Rent-A-Car (ブラザーレンタカー)",
                            mapLocation: "沖縄県那覇市田原3-1-8",
                            cost: 25470,
                            note: "預計1小時，含保險。費用：$5,349 TWD",
                            mapLink: "https://maps.app.goo.gl/zqpsHZkhGTZXQbEd7"
                        },
                        { time: "10:30", endTime: "11:30", title: "早午餐：客美多咖啡", type: "meal", location: "客美多咖啡 沖繩糸滿店", cost: 1000, note: "停留約1小時" },
                        { time: "12:00", endTime: "15:30", title: "沖繩世界 - 玉泉洞", type: "activity", location: "沖繩世界 文化王國・玉泉洞", cost: 0, note: "13:30 毒蛇秀，預計停留3小時" },
                        { time: "15:40", endTime: "16:30", title: "奧武島觀光", type: "activity", location: "奧武島", cost: 0, note: "停留約1小時，吃炸物" },
                        {
                            time: "17:00",
                            endTime: "18:00",
                            title: "Ricoland Okinawa",
                            type: "activity",
                            location: "Ricoland Okinawa",
                            mapLocation: "Ricoland Okinawa",
                            cost: 0,
                            note: "機車用品店，停留1小時"
                        },
                        {
                            time: "18:00",
                            endTime: "19:00",
                            title: "飯店 Check-in",
                            type: "transport",
                            location: "HOTEL NAHA CITY",
                            mapLocation: "1 Chome-4-5 Matsuo, Naha, Okinawa 900-0014日本",
                            cost: 6881,
                            note: "停車費用 ¥1000/日。備註：10F吸菸區"
                        },
                        {
                            time: "18:40",
                            endTime: "20:30",
                            title: "晚餐：Buchi Kumojiten (烤肉)",
                            type: "meal",
                            location: "Yakiniku Buchi Kumoji (燒肉 Buchi 久茂地店)",
                            mapLocation: "Yakiniku Buchi Kumoji",
                            cost: 5000,
                            note: "【已預訂】18:40。必點：生牛肉赤身、土鍋飯。(提醒：訂了兩家，需選一家)"
                        }
                    ]
                },
                {
                    day: 2,
                    date: "12/31 (三)",
                    dateStr: "2025-12-31",
                    events: [
                        {
                            time: "07:00",
                            endTime: "07:30",
                            title: "早餐：福助玉子燒 或 豬肉蛋飯糰",
                            type: "meal",
                            location: "牧志市場周邊",
                            cost: 1000,
                            note: "走路10分鐘。福助7:30開 / 飯糰7:00開"
                        },
                        {
                            time: "09:00",
                            endTime: "13:00",
                            title: "Parco City 逛街",
                            type: "activity",
                            location: "浦添西海岸 PARCO CITY",
                            cost: 5000,
                            note: "停車免費。開車約20分鐘"
                        },
                        {
                            time: "13:30",
                            endTime: "14:30",
                            title: "午餐：敘敘苑燒肉",
                            type: "meal",
                            location: "敘敘苑 沖繩浦添PARCO CITY店",
                            cost: 3000,
                            note: "【已預訂】預約 13:30"
                        },
                        {
                            time: "15:00",
                            endTime: "16:00",
                            title: "漫畫倉庫 / 港川外人住宅",
                            type: "activity",
                            location: "港川外人住宅街",
                            cost: 300,
                            note: "浦添區。開車約9分鐘"
                        },
                        {
                            time: "18:30",
                            endTime: "19:00",
                            title: "飯店 Check-in",
                            type: "transport",
                            location: "HOTEL YUQUESTA AGARIMACHI",
                            mapLocation: "7-22 Higashimachi, Naha, Okinawa 900-0034日本",
                            cost: 0,
                            note: "需找停車場，盡量早回"
                        },
                        {
                            time: "20:00",
                            endTime: "21:30",
                            title: "晚餐：LITOR",
                            type: "meal",
                            location: "LITOR",
                            cost: 2000,
                            note: "【已預訂】預約 20:00。不能遲到！(遲到當天退費也扣錢)"
                        },
                        {
                            time: "22:00",
                            endTime: "00:30",
                            title: "跨年活動：Churasun 6",
                            type: "activity",
                            location: "Churasun 6",
                            mapLocation: "Churasun 6, Naha",
                            cost: 4500,
                            note: "【已預訂】預約 22:00 (22:30 開始)"
                        }
                    ]
                },
                {
                    day: 3,
                    date: "01/01 (四)",
                    dateStr: "2026-01-01",
                    events: [
                        { time: "08:00", endTime: "08:30", title: "早餐：A&W 漢堡", type: "meal", location: "A&W 牧港店", cost: 300, note: "元旦早餐" },
                        { time: "09:00", endTime: "09:30", title: "萬座毛", type: "activity", location: "萬座毛", cost: 100, note: "可以不去，可能會很趕，不然要更早出門" },
                        {
                            time: "12:00",
                            endTime: "12:30",
                            title: "午餐：許田休息站 或 CAMEL SANDWICH",
                            type: "meal",
                            location: "許田休息站",
                            cost: 300,
                            note: "隨意吃或吃三明治"
                        },
                        {
                            time: "14:00",
                            endTime: "17:00",
                            title: "美麗海水族館",
                            type: "activity",
                            location: "沖繩美麗海水族館",
                            cost: 2200,
                            note: "【攻略】P7北停車場最近。13:20排隊餵海豚、14:00餵海龜、15:00鯨鯊餵食(黑潮之海)、17:00海豚表演"
                        },
                        {
                            time: "18:00",
                            endTime: "18:30",
                            title: "飯店 Check-in",
                            type: "transport",
                            location: "Super Hotel Nago",
                            mapLocation: "Super Hotel Okinawa Nago",
                            cost: 5440,
                            note: "提早到選枕頭。超級飯店(名護)"
                        },
                        {
                            time: "19:00",
                            endTime: "21:00",
                            title: "晚餐：百年古家 大家 (阿古豬)",
                            type: "meal",
                            location: "Ufuya (百年古家 大家)",
                            mapLocation: "Ufuya, Nago",
                            cost: 4880,
                            note: "【已預訂】預約 19:30"
                        }
                    ]
                },
                {
                    day: 4,
                    date: "01/02 (五)",
                    dateStr: "2026-01-02",
                    events: [
                        { time: "07:00", endTime: "09:30", title: "早餐：飯店早餐", type: "meal", location: "Super Hotel Nago", cost: 0, note: "" },
                        {
                            time: "09:00",
                            endTime: "10:00",
                            title: "古宇利海洋塔",
                            type: "activity",
                            location: "古宇利海洋塔",
                            cost: 1000,
                            note: "欣賞風景"
                        },
                        {
                            time: "11:30",
                            endTime: "12:00",
                            title: "午餐：古宇利蝦蝦飯",
                            type: "meal",
                            location: "Kouri Shrimp",
                            mapLocation: "Kouri Shrimp Wagon",
                            cost: 2160,
                            note: "附近還有 NoBi"
                        },
                        {
                            time: "13:30",
                            endTime: "14:30",
                            title: "美國村",
                            type: "activity",
                            location: "美國村",
                            mapLocation: "American Village Okinawa",
                            cost: 1500,
                            note: "逛街拍照"
                        },
                        {
                            time: "15:00",
                            endTime: "16:00",
                            title: "永旺夢樂城 (Aeon Mall)",
                            type: "activity",
                            location: "AEON MALL Okinawa Rycom",
                            cost: 5000,
                            note: "大型購物中心"
                        },
                        {
                            time: "19:00",
                            endTime: "20:00",
                            title: "晚餐：傑克牛排",
                            type: "meal",
                            location: "Jack's Steak House (傑克牛排 那霸店)",
                            mapLocation: "Jack's Steak House Naha Okinawa",
                            cost: 3000,
                            note: "可以19:00先去吃，再 Check-in 走回去"
                        },
                        {
                            time: "19:30",
                            endTime: "21:00",
                            title: "飯店 Check-in",
                            type: "transport",
                            location: "Rembrandt Style Naha",
                            mapLocation: "Rembrandt Style Naha",
                            cost: 4710,
                            note: "那霸倫勃朗風格飯店"
                        }
                    ]
                },
                {
                    day: 5,
                    date: "01/03 (六)",
                    dateStr: "2026-01-03",
                    events: [
                        { time: "07:00", endTime: "09:30", title: "早餐：飯店早餐", type: "meal", location: "Rembrandt Style Naha", cost: 0, note: "" },
                        { time: "09:30", endTime: "10:00", title: "波上宮", type: "activity", location: "波上宮", cost: 0, note: "參拜拍照" },
                        {
                            time: "10:00",
                            endTime: "11:00",
                            title: "早午餐：幸福鬆餅",
                            type: "meal",
                            location: "A Happy Pancake Umikaji Terrace",
                            cost: 2000,
                            note: "路邊停車免費，需排隊"
                        },
                        {
                            time: "12:00",
                            endTime: "13:00",
                            title: "購物：iias 沖繩豐崎",
                            type: "activity",
                            location: "iias Okinawa Toyosaki",
                            cost: 5000,
                            note: "最後採買"
                        },
                        {
                            time: "16:30",
                            endTime: "17:00",
                            title: "購物：Workman",
                            type: "activity",
                            location: "Workman Plus",
                            cost: 5000,
                            note: "機能服飾"
                        },
                        { time: "17:00", endTime: "18:00", title: "還車/前往機場", type: "transport", location: "那霸機場", cost: 0, note: "需預留還車時間" },
                        { time: "21:30", endTime: "22:05", title: "返程航班", type: "transport", location: "IT233", cost: 0, note: "21:30 起飛" }
                    ]
                }
            ],
            budget: [
                { item: "機票 (已付)", twd: 17902, note: "二人總計" },
                { item: "租車 (5天4夜)", twd: 5348, note: "預估 25470 JPY" },
                { item: "住宿 (總計)", twd: 6416, note: "四晚預估" },
                { item: "日本譯文駕照", twd: 256, note: "監理所申請" },
                { item: "活動門票", twd: 2000, note: "預估" },
                { item: "餐飲費用", twd: 10000, note: "預估" }
            ]
        };

        // 新增組件：倒數時鐘
        const CountdownTimer = ({ targetDateStr, targetTimeStr }) => {
            const [timeLeft, setTimeLeft] = useState("");

            useEffect(() => {
                const calculateTimeLeft = () => {
                    const target = new Date(`${targetDateStr}T${targetTimeStr}:00`);
                    const now = new Date();
                    const diff = target - now;

                    if (diff <= 0) {
                        return "00:00:00";
                    }

                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                    const minutes = Math.floor((diff / 1000 / 60) % 60);
                    const seconds = Math.floor((diff / 1000) % 60);

                    // 僅顯示時分秒，若超過24小時可顯示天
                    if (days > 0) {
                        return `${days}天 ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    }
                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                };

                setTimeLeft(calculateTimeLeft());
                const timer = setInterval(() => {
                    setTimeLeft(calculateTimeLeft());
                }, 1000);

                return () => clearInterval(timer);
            }, [targetDateStr, targetTimeStr]);

            return (
                <div className="flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg border border-purple-200 min-w-[120px]">
                    <div className="text-xs text-purple-600 font-bold mb-1 flex items-center">
                        <span className="mr-1 animate-pulse">●</span> 即將開始
                    </div>
                    <div className="text-xl font-mono font-black text-gray-800 tracking-wider">
                        {timeLeft}
                    </div>
                </div>
            );
        };

        // 新增組件：單個行程項目
        const EventItem = ({ event, isNext }) => {
            const [isMapVisible, setIsMapVisible] = useState(false);

            // 處理地圖 URL
            const queryLocation = event.mapLocation || event.location;
            const mapQuery = encodeURIComponent(queryLocation);
            const mapUrl = `https://maps.google.com/maps?q=${mapQuery}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
            const externalMapUrl = event.mapLink || `https://www.google.com/maps/search/?api=1&query=${mapQuery}`;

            return (
                <div className={`relative pl-8 group ${isNext ? 'z-10' : ''}`}>
                    {/* 時間軸圓點 */}
                    <div className={`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm transition-all duration-300 ${isNext
                            ? 'bg-purple-600 scale-125 ring-4 ring-purple-100'
                            : event.type === 'transport' ? 'bg-gray-400' :
                                event.type === 'meal' ? 'bg-orange-400' :
                                    'bg-blue-500'
                        }`}></div>

                    <div className={`flex flex-col sm:flex-row sm:items-start justify-between p-3 rounded-xl transition-all duration-300 -mt-2 ${isNext ? 'bg-purple-50 shadow-md ring-2 ring-purple-200' : 'group-hover:bg-gray-50'
                        }`}>
                        <div className="flex-1 w-full relative">
                            {/* 倒數計時器：顯示在最近行程的右側 (大螢幕) 或上方 (手機) */}
                            {isNext && (
                                <div className="absolute right-0 top-0 sm:-top-2 sm:right-0 transform sm:translate-x-4 -translate-y-full sm:translate-y-0 z-20 mb-2 sm:mb-0">
                                    <CountdownTimer targetDateStr={event.dateStr} targetTimeStr={event.time} />
                                </div>
                            )}

                            <div className="flex items-center mb-1">
                                <span className={`font-mono text-sm font-bold w-24 flex-shrink-0 ${isNext ? 'text-purple-700' : 'text-gray-500'}`}>
                                    {event.time}
                                </span>
                                <h4 className={`text-base font-bold flex items-center ${isNext ? 'text-purple-900' : 'text-gray-800'}`}>
                                    {event.title}
                                </h4>
                            </div>

                            <div className="flex flex-col sm:flex-row text-sm text-gray-600 ml-0 sm:ml-24 space-y-1 sm:space-y-0 sm:space-x-4 mb-2">
                                <div className="flex items-center">
                                    <span className="mr-1 text-gray-400"><Icons.MapPin /></span>
                                    {event.location}
                                </div>
                                {event.note && (
                                    <div className="flex items-center text-gray-500 bg-white/50 px-2 py-0.5 rounded text-xs">
                                        <span className="mr-1"><Icons.Info /></span>
                                        {event.note}
                                    </div>
                                )}
                            </div>

                            {/* 按鈕區域 */}
                            <div className="ml-0 sm:ml-24 mt-2 sm:mt-0 flex flex-wrap gap-2">
                                <button
                                    onClick={() => setIsMapVisible(!isMapVisible)}
                                    className={`text-xs flex items-center px-3 py-1.5 rounded-full transition-colors font-medium border ${isMapVisible
                                            ? "bg-gray-200 text-gray-700 border-gray-300"
                                            : "bg-white text-gray-600 border-gray-200 hover:bg-gray-50"
                                        }`}
                                >
                                    <span className="mr-1"><Icons.Map /></span>
                                    {isMapVisible ? "隱藏地圖" : "查看地圖"}
                                </button>
                            </div>

                            {/* 地圖嵌入區塊 */}
                            {isMapVisible && (
                                <div className="ml-0 sm:ml-24 mt-3 rounded-xl overflow-hidden border border-gray-200 shadow-inner bg-gray-100 animate-fade-in">
                                    <iframe
                                        width="100%"
                                        height="250"
                                        frameBorder="0"
                                        scrolling="no"
                                        marginHeight="0"
                                        marginWidth="0"
                                        src={mapUrl}
                                        title={`Map of ${event.location}`}
                                        className="w-full block"
                                    ></iframe>
                                    <div className="bg-gray-50 py-2 px-3 text-xs flex justify-end border-t border-gray-200">
                                        <a
                                            href={externalMapUrl}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="flex items-center text-blue-600 hover:text-blue-800 font-medium transition-colors"
                                        >
                                            開啟 Google Maps <span className="ml-1"><Icons.ExternalLink /></span>
                                        </a>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* 費用顯示 */}
                        {(event.cost > 0) && (
                            <div className="mt-2 sm:mt-0 ml-0 sm:ml-4 text-right flex-shrink-0">
                                <span className="text-xs text-gray-400 block">預估花費</span>
                                <span className="font-mono text-sm font-medium text-gray-700">¥{event.cost.toLocaleString()}</span>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // UI 組件：標籤頁切換
        const Tabs = ({ activeTab, onTabChange }) => {
            const tabs = [
                { id: "itinerary", label: "行程表", icon: Icons.Calendar },
                { id: "logistics", label: "住宿與航班", icon: Icons.Hotel },
                { id: "budget", label: "預算概覽", icon: Icons.Wallet },
            ];

            return (
                <div className="flex space-x-1 bg-gray-200 p-1 rounded-lg mb-6">
                    {tabs.map((tab) => (
                        <button
                            key={tab.id}
                            onClick={() => onTabChange(tab.id)}
                            className={`flex items-center justify-center flex-1 py-2.5 text-sm font-medium rounded-md transition-all duration-200 ${activeTab === tab.id
                                    ? "bg-white text-blue-600 shadow-sm"
                                    : "text-gray-500 hover:text-gray-700 hover:bg-gray-100"
                                }`}
                        >
                            <span className="mr-2"><tab.icon /></span>
                            {tab.label}
                        </button>
                    ))}
                </div>
            );
        };

        // UI 組件：行程時間軸
        const ItineraryView = ({ data }) => {
            const [activeDay, setActiveDay] = useState(data[0]?.day || 1);
            const [nextEventId, setNextEventId] = useState(null);

            // 計算最近的行程
            useEffect(() => {
                const now = new Date(); // 實際使用時為當前時間
                // 為了展示效果，這裡可以模擬一個時間，例如：
                // const now = new Date("2025-12-31T12:00:00"); 

                let closestEvent = null;
                let minDiff = Infinity;

                data.forEach(day => {
                    day.events.forEach((event, idx) => {
                        const eventTime = new Date(`${day.dateStr}T${event.time}:00`);
                        const diff = eventTime - now;

                        // 找出第一個還沒發生的行程 (diff > 0) 且距離現在最近
                        if (diff > 0 && diff < minDiff) {
                            minDiff = diff;
                            closestEvent = { day: day.day, idx: idx };
                        }
                    });
                });

                if (closestEvent) {
                    setNextEventId(closestEvent);
                    // 自動切換到該天 (僅在非手動切換時)
                    // setActiveDay(closestEvent.day); 
                }
            }, [data]);

            const currentDay = data.find(d => d.day === activeDay) || data[0];

            return (
                <div>
                    {/* 天數切換 Tab */}
                    <div className="flex overflow-x-auto space-x-2 mb-6 pb-2 scrollbar-hide">
                        {data.map((day) => (
                            <button
                                key={day.day}
                                onClick={() => setActiveDay(day.day)}
                                className={`flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition-all whitespace-nowrap shadow-sm border ${activeDay === day.day
                                        ? "bg-blue-600 text-white border-blue-600"
                                        : "bg-white text-gray-500 hover:bg-gray-50 border-gray-200"
                                    }`}
                            >
                                Day {day.day}
                                <span className={`ml-2 text-xs font-normal ${activeDay === day.day ? "text-blue-200" : "text-gray-400"}`}>
                                    {day.date.split(' ')[0]}
                                </span>
                            </button>
                        ))}
                    </div>

                    {/* 單日內容 */}
                    <div className="animate-fade-in">
                        <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                            <div className="bg-blue-50 px-6 py-4 border-b border-blue-100 flex justify-between items-center">
                                <div>
                                    <span className="text-blue-600 font-bold text-lg mr-3">Day {currentDay.day}</span>
                                    <span className="text-gray-700 font-medium">{currentDay.date}</span>
                                </div>
                            </div>
                            <div className="p-6">
                                <div className="relative border-l-2 border-blue-100 ml-3 space-y-8">
                                    {currentDay.events.map((event, idx) => {
                                        const isNext = nextEventId && nextEventId.day === currentDay.day && nextEventId.idx === idx;
                                        return (
                                            <EventItem
                                                key={idx}
                                                event={{ ...event, dateStr: currentDay.dateStr }}
                                                isNext={isNext}
                                            />
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // UI 組件：住宿與航班
        const LogisticsView = ({ flights, hotels }) => {
            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span className="mr-2 text-blue-500"><Icons.Plane /></span> 航班資訊
                        </h3>
                        <div className="space-y-4">
                            {flights.map((flight, idx) => (
                                <div key={idx} className="border-l-4 border-blue-500 bg-blue-50 p-4 rounded-r-lg">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="bg-blue-200 text-blue-800 text-xs font-bold px-2 py-1 rounded">{flight.type}</span>
                                        <span className="font-mono font-bold text-gray-700">{flight.code}</span>
                                    </div>
                                    <div className="flex justify-between items-center text-sm text-gray-700 mb-2">
                                        <div className="text-center">
                                            <div className="font-bold text-lg">{flight.from}</div>
                                            <div className="text-gray-500 text-xs">出發</div>
                                        </div>
                                        <div className="px-2 text-gray-400"><Icons.ArrowRight /></div>
                                        <div className="text-center">
                                            <div className="font-bold text-lg">{flight.to}</div>
                                            <div className="text-gray-500 text-xs">抵達</div>
                                        </div>
                                    </div>
                                    <div className="flex justify-between text-sm text-gray-600 border-t border-blue-200 pt-2 mt-2">
                                        <span><Icons.Clock /> {flight.time}</span>
                                        <span>座: {flight.seat}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span className="mr-2 text-orange-500"><Icons.Hotel /></span> 住宿安排
                        </h3>
                        <div className="space-y-4">
                            {hotels.map((hotel, idx) => (
                                <div key={idx} className="flex flex-col border-b border-gray-100 pb-3 last:border-0 last:pb-0">
                                    <div className="flex justify-between items-start mb-1">
                                        <span className="text-sm font-bold text-gray-500 bg-gray-100 px-2 py-0.5 rounded">{hotel.date}</span>
                                        <span className="text-sm font-mono text-gray-600">¥{hotel.price}</span>
                                    </div>
                                    <h4 className="font-bold text-gray-800 text-sm mb-1">{hotel.name}</h4>
                                    <div className="flex justify-between text-xs text-gray-500">
                                        <span className="flex items-center"><span className="mr-1 w-3"><Icons.MapPin /></span>{hotel.area}</span>
                                        <span>{hotel.note}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // UI 組件：預算概覽
        const BudgetView = ({ budget }) => {
            const total = budget.reduce((sum, item) => sum + item.twd, 0);

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 relative">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="text-lg font-bold text-gray-800 flex items-center">
                            <span className="mr-2 text-green-600"><Icons.Wallet /></span> 預估費用 (TWD)
                        </h3>
                    </div>

                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="text-gray-500 border-b border-gray-200 text-sm">
                                    <th className="py-2 font-medium">項目</th>
                                    <th className="py-2 font-medium text-right">金額 (TWD)</th>
                                    <th className="py-2 font-medium pl-4">備註</th>
                                </tr>
                            </thead>
                            <tbody className="text-sm">
                                {budget.map((item, idx) => (
                                    <tr key={idx} className="border-b border-gray-100 hover:bg-gray-50">
                                        <td className="py-3 text-gray-800">{item.item}</td>
                                        <td className="py-3 text-right font-mono font-medium">{item.twd.toLocaleString()}</td>
                                        <td className="py-3 pl-4 text-gray-500 text-xs">{item.note}</td>
                                    </tr>
                                ))}
                            </tbody>
                            <tfoot>
                                <tr className="bg-gray-50 font-bold text-gray-800">
                                    <td className="py-3 pl-2">總計預估</td>
                                    <td className="py-3 text-right font-mono text-lg text-green-600">{total.toLocaleString()}</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div className="mt-4 text-xs text-gray-400 text-right">
                        * 實際費用請依當下匯率與消費為主
                    </div>
                </div>
            );
        };

        // 主應用程式
        const App = () => {
            const [activeTab, setActiveTab] = useState("itinerary");

            useEffect(() => {
                lucide.createIcons();
            }, [activeTab]);

            return (
                <div className="max-w-3xl mx-auto px-4 py-8 min-h-screen">
                    {/* 標題區 */}
                    <div className="mb-8 text-center">
                        <h1 className="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">{TRIP_DATA.meta.title}</h1>
                        <p className="text-gray-500 flex justify-center items-center space-x-4 text-sm mb-4">
                            <span className="flex items-center"><span className="mr-1"><Icons.Calendar /></span>{TRIP_DATA.meta.dates}</span>
                            <span className="w-1 h-1 bg-gray-300 rounded-full"></span>
                            <span>{TRIP_DATA.meta.travelers} 人</span>
                        </p>
                    </div>

                    {/* 導航 */}
                    <Tabs activeTab={activeTab} onTabChange={setActiveTab} />

                    {/* 螢幕顯示內容區 */}
                    <div className="animate-fade-in pb-12">
                        {activeTab === "itinerary" && <ItineraryView data={TRIP_DATA.itinerary} />}
                        {activeTab === "logistics" && <LogisticsView flights={TRIP_DATA.flights} hotels={TRIP_DATA.hotels} />}
                        {activeTab === "budget" && <BudgetView budget={TRIP_DATA.budget} />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>